# Soft Dis-Play MVP タスク（SDD）

## フェーズ0: 設計・仕様 (SDD)
- [x] ゲームシステム設計書 (game_design.md)
- [x] インフラ調査・選定 (infrastructure_research.md)
- [x] カードデータJSON作成 (src/data/cards.json)
- [x] MVP仕様書・実装計画書 (implementation_plan.md)

## フェーズEX: 語彙・カード構成の抜本的改善 (2026-02-24)
- [x] カード構成の再検討（ゲームデザイナー・数学的観点）
- [x] `src/data/cards.json` の170枚構成への刷新
  - [x] クッションカード（30枚）
  - [x] 悪口カード（40枚：汎用フレーズ化）
  - [x] 名詞カード（50枚：具体化）
  - [x] 助詞カード（50枚：文末表現・副詞追加）
- [x] `docs/game_design.md` の更新反映
- [x] `docs/walkthrough.md` への改善内容の記録

## フェーズ1: プロジェクトセットアップ
- [x] Next.js + TypeScriptプロジェクト初期化（Tailwind CSS含む）
- [x] @supabase/supabase-jsインストール
- [x] src/types/index.ts（型定義）作成
- [x] src/lib/supabase.ts（クライアント初期化）作成
- [x] .env.local雛形作成
- [x] Supabaseプロジェクト作成・テーブル設計（API反映・SQL実行済）

## フェーズ2: Supabaseデータモデル設計・実装
- [x] `rooms` テーブル設計・作成
- [x] `players` テーブル設計・作成
- [x] `game_state` テーブル設計・作成
- [x] Row Level Security (RLS) ポリシー設定（省略・パブリック）
- [x] Realtime購読の動作確認（SQL実行済）

## フェーズ3: ゲームコアロジック実装（型定義・仕様から）
- [x] TypeScript型定義ファイル作成 (types/)
- [x] カードデッキ管理ロジック (shuffle, deal)
- [x] ラウンド進行管理ロジック (フェーズ遷移)
- [x] 投票集計ロジック

## フェーズ4: 画面（UI）実装
- [x] ロビー画面 (ルーム作成・参加)
- [x] 手札・カード交換画面
- [x] カード選択画面
- [x] 発表画面（全員の組み合わせ表示）
- [x] 投票画面
- [x] 結果・スコアボード画面

## フェーズ5: オンライン同期・テスト（旧記録）
- [x] Supabase Realtimeでフェーズ・状態同期
- [x] タイマー同期（MVPではホストの進行ボタンで代替）
- [ ] 複数ブラウザタブでの動作確認
- [ ] Vercelへのデプロイ

---

# 今後の作業タスク（再設計版：バグ修正・オンラインテスト再開）

## 新フェーズ5: オンライン同期デバッグ・修正（★現在ここ）
前回のテストで発生した「フェーズが遷移しない（DBがUPDATEされない）」問題の解決を最優先課題とします。

- [x] **バックエンド（Supabase RLS）の権限確認と修正**
  - [x] Supabaseダッシュボードにて、データベースの `game_states` テーブルの RLS（Row Level Security）ポリシー設定を確認する。（結果：Disabled）
  - [x] `anon` キーによる `UPDATE` が許可されていない場合は、適切なポリシー（例：Publicアクセス許可など）を追加・修正する。（不要だった）
- [x] **フロントエンド側のエラーハンドリングの追加**
  - [x] 状態更新ボタン押下時の `update()` 実行箇所に、エラー発生時 `console.error(error)` を出力するデバッグ処理を追加する。
  - [ ] （オプション）ユーザーがエラーに気づけるよう、必要に応じてUIへのエラー表示（アラートなど）を追加する。
- [x] **フェーズ遷移のロジック修正と再テスト**
  - [x] ホストのみが強引にフェーズを進めていたロジック案を撤廃し、全員が確認完了した時点で `select` に進むロジックに修正（`votes` フィールド流用）。
  - [x] 交換フェーズ（`exchange`）から選択フェーズ（`select`）へ正常に移行できるか確認する。

## 新フェーズ6: ゲームサイクルの完走とテスト
同期がうまくいった後の後続タスクです。

- [x] 選択フェーズ以降（`reveal`, `vote`, `result`）がすべて正常にオンライン同期しながら進行できるかのテスト
- [x] ゲーム終了時（`gameover`）への遷移と、スコア計算の確認
- [x] 複数ブラウザタブ（3番目のプレイヤーなど）を含めた総合的な動作確認

## 新フェーズ7: MVP公開・最終調整
- [x] 未実装・残件の整理（タイマー同期の実装見送り判断の再確認など）
- [x] Vercel等への最終デプロイと実機（スマホなど）での挙動確認
