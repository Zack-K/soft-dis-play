# Soft Dis-Play インフラ・技術選定調査レポート

Web上でオンラインマルチプレイボードゲーム（リアルタイム通信・手札同期が必須）を実現するための技術スタックとインフラ構成案について調査しました。

---

## 求められる要件

1. **リアルタイム双方向通信**
   - 誰かがカードを出した、ラウンドが進んだなどの状態を全員の画面に即座に反映させる必要がある（最大4人）。
2. **状態管理（State Management）**
   - 「誰がどのカードを持っているか」「今は誰のターン（フェーズ）か」というゲームの進行状態を、不正がないようにサーバー側で管理（または全員で同期）する仕組みが必要。
3. **ルーム作成・マッチング機能**
   - プレイヤー同士が同じ部屋（URLやルームコード）で遊べる仕組み。
4. **低コスト・サーバーレス（運用負荷減）**
   - 個人開発・小規模運用を想定し、初期コストやサーバー保守の手間が極力少ない構成が望ましい。

---

## 構成案の比較

要件を満たすための現実的なアプローチとして、以下の3つの構成案を提案します。

### 案A：BaaS（Backend as a Service）活用構成 ★一番おすすめ

リアルタイム通信機能を持つデータベースサービスを使って、サーバー開発の手間を大幅に削る構成。

- **フロントエンド**: React (Next.js) または Vue (Nuxt.js)
  - 理由: コンポーネント指向でカードや手札のUIを作りやすい。
- **データベース & リアルタイム同期**: **Supabase** または **Firebase**
  - Supabase (PostgreSQLベース) の `Realtime` 機能、または Firebase の `Firestore` や `Realtime Database` を使用。
  - ルーム情報や各プレイヤーの手札データをDBに書き込むと、他のプレイヤーの画面に自動的に変更がプッシュされる。
- **ホスティング**: Vercel または Netlify
  - 理由: GitHubと連携して無料で簡単にWebアプリを公開できる。

**👍 メリット**: 
- 自前でWebSocketサーバー（Node.jsなど）を立てる必要がなく、インフラ管理がほぼゼロ。
- 無料枠が充実しているため、開発〜少人数プレイなら完全に無料で運用できる。

**👎 デメリット**:
- ゲームの複雑なロジック（カードの勝敗判定など）をフロントエンドで処理するか、Cloud Functionsなどを利用する必要がある。

### 案B：フルスタックフレームワーク + WebSocketサーバー構成

ゲームのルール判定（チート防止）もすべてサーバー側でカッチリ行いたい場合の王道構成。

- **フロントエンド & バックエンド**: **Next.js** ＋ **Socket.IO** 
  - 理由: Next.jsのカスタムサーバー機能や、別のNode.jsサーバーを立ててSocket.IOでリアルタイム通信を行う。
  - 最近では、ゲーム状態管理に特化した **Colyseus** というマルチプレイ用Node.jsフレームワークも非常に強力。
- **ホスティング**: Render または Fly.io または VPS (ConoHaなど)
  - VercelなどのServerless環境はWebSocketの常時接続と相性が悪いため、コンテナや仮想サーバーを動かせるPaaSを利用する。

**👍 メリット**: 
- サーバー側で「手札のシャッフル」「ルールの強制」を完全に制御できる。
- ゲームが複雑になっても対応しやすい（将来的に拡張性が高い）。

**👎 デメリット**:
- リアルタイムサーバーを常時稼働させるため、ホスティング費用が若干かかる（数百円〜/月）。
- Vercelの手軽なデプロイが使えないため、環境構築の難易度が少し上がる。

### 案C：P2P（サーバーを経由しない通信）構成

サーバーでお金を一切かけず、ブラウザ同士を直接つなぐ構成。

- **フロントエンド**: React や Vanilla JS
- **通信技術**: **WebRTC** (ライブラリ例: `PeerJS`)
  - 1人が「ホスト」になり、他の人がそこに直接接続してデータをやり取りする。
- **ホスティング**: GitHub Pages、Vercel などどこでもOK

**👍 メリット**: 
- バックエンドサーバーやデータベースが一切不要。完全無料で維持可能。
- 静的サイトとしてホスティングできる。

**👎 デメリット**:
- ブラウザ同士の相性やネットワーク環境（ファイアウォールなど）によっては接続できない人が出る。
- ホスト役のプレイヤーが切断するとゲームが崩壊する。

---

## クラウドインフラ設定（A案）

今回の技術選定における具体的なクラウドインフラは、**【Vercel (フロントエンド・ホスティング) + Supabase (データベース＆リアルタイム同期)】** の組み合わせを強く推奨します。

### Vercel（フロントエンドのホスティング）
Vercelは、モダンなWebアプリ（特にReact / Next.js）を公開するためのクラウドプラットフォームです。

**おすすめの理由：**
- **デプロイ（公開）が圧倒的に簡単**：GitHubにコードをプッシュするだけで、自動的にVercelがサーバー上に配置してWeb公開してくれます。
- **無料枠での運用が十分可能**：個人開発レベルのアクセス数であれば、完全無料（Hobbyプラン）で利用できます。

### Supabase（データベース＆リアルタイム同期）
Supabaseは「オープンソース版Firebase」と呼ばれるBackend as a Serviceで、データベースの変更をアプリ画面にリアルタイムで反映させる機能（Realtime）が強力です。

**おすすめの理由（Firebaseとの比較）：**
- **リレーショナルデータ（表形式）で管理しやすい**：Firebase（NoSQL）に対し、SupabaseはPostgreSQLを採用しています。ゲームの「ルーム」「プレイヤー」「手札状態」といった複雑なデータを関連付けて設計しやすく好相性です。
- **リアルタイム同期がシンプル**：DBの変更をキャッチして「全員の画面を更新する」という処理が、フロントエンド側から簡単に実装できます。無料枠も小規模運用なら十分すぎます。

### 具体的な開発スタック（まとめ）
この構成をベースにすると、開発で使用する技術は以下に定まります。

- **言語**: TypeScript（ゲームの複雑な状態をバグなく記述するため）
- **UIフレームワーク**: React ＋ Tailwind CSS（デザインを素早く構築するため）
- **Webフレームワーク**: Next.js (App Router環境)
- **バックエンド（DB・通信）**: Supabase
- **ホスティング**: Vercel

---

## 今後の開発ステップ提案

1. **技術スタックの確定とプロジェクト作成**
   - Vercel・Supabaseのサインアップ、React+Next.jsプロジェクト(`create-next-app`)の立ち上げ
2. **データモデルの設計**
   - Supabaseに「Rooms（部屋）」「Players（参加者）」「GameState（現在のラウンド、だれの手番か）」のテーブルを設計。
3. **コアロジックのモック作成**
   - ネットワーク通信なしで、1つの画面上でゲームが回るか（手札選択〜投票まで）を作る。
4. **オンライン化**
   - Supabaseをつなぎこみ、複数ブラウザ（タブ）で状態が同期されるかを確認。
5. **UIのブラッシュアップ**
   - カードのデザインやアニメーション、洗練されたUIの追加。
